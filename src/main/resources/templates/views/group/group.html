<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{views/commons/layout :: layout(~{::head} ,~{::main} ) }">

<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="/css/group/group.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/ScrollTrigger.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet" />
	<script src="/js/group/group.js"></script>
</head>

<body>
	<main>
		<div class="group-container">
			<!-- Left Section: Header Image and Title Card -->
			<div id="groupInfoSection">
			<div class="left-section" th:each="group : ${groups}">
				<!-- Header Image -->
				<div class="header-image" th:style="|background-image: url(${group.mainImageUrl});|"></div>
				<!-- Title Card -->
				<div class="title-card">
					<div class="small-title" th:text="${group.groupName}">인생샷 사진사</div>
					<div class="main-title" th:text="${group.category}"></div>
				</div>

				<!-- Additional Information -->
				<div class="info-box">
					<h3>참여하시는 분들께</h3>
					<p th:utext="${group.greeting}"></p>
				</div>

				<!-- Review Section -->
				<div class="review-section">
					<h4>참여자 후기</h4>
					<p>"정말 멋진 경험이었어요! 많은 것을 배웠고, 새로운 친구들도 사귈 수 있었습니다." - 김영희</p>
					<p>"매주 금요일을 기다리게 되는 모임입니다. 사진 찍는 기술도 많이 늘었어요!" - 박철수</p>
				</div>
			</div>

			<!-- Right Section: Group Details and Actions -->
			<div class="right-section" th:each="group : ${groups}">
				<!-- Group Description -->
				<div class="content-section">
					<div class="section-title">그룹 설명</div>
					<div class="group-description" th:utext="${group.description}"></div>
				</div>

				<!-- Members List -->
				<div class="member-intro">
					<h4>멤버소개</h4>
					<h3 th:text="${group.creatorNickname} + ' 님이 만든 모임입니다.'">우리 반갑게 만나요</h3>
					<div class="profile">
						<img src="/images/profile1.jpg" alt="프로필 사진 1">
					</div>

					<h3>참여자 목록</h3>
					<!-- Profile List -->
					<div class="profile-list">
						<img src="/images/profile1.jpg" alt="프로필 사진 1">
						<img src="/images/profile1.jpg" alt="프로필 사진 2">
						<img src="/images/profile1.jpg" alt="프로필 사진 3">
						<img src="/images/profile1.jpg" alt="프로필 사진 4">
						<div class="add-member">+</div> <!-- 추가 회원 버튼 -->
					</div>

					<!-- Announcements -->
					<div class="content-section">
						<div class="section-title">공지 사항</div>
						<ul class="announcement-list">
							<li>다음 모임은 9월 15일 저녁 7시에 한강공원에서 진행됩니다.</li>
							<li>사진 콘테스트 개최! 우승자에게는 특별한 상품이 주어집니다.</li>
						</ul>
					</div>

					<!-- 알림 메시지 표시 -->
					<div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
					<div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

					<!-- 그룹 가입 버튼 -->
					<form th:action="@{/join-group/{id}(id=${group.id})}" method="post" style="display:inline;">
						<input type="hidden" name="_csrf" th:value="${_csrf.token}" /> <!-- CSRF 토큰 -->
						<button type="submit" class="join-button" th:if="${not isMember}">그룹 가입하기</button>
					</form>
					<span th:if="${isMember}" class="joined-message">이미 그룹의 멤버입니다</span>
					<a href="/create-group" class="create-group-button">나도 만들러 가기</a>

					<!-- 그룹 수정 버튼 -->
					<div th:if="${isCreator}">
						<button class="edit-group-button" onclick="openEditGroupForm()">그룹 수정하기</button>
					</div>
</div>
					<!-- 수정 폼 섹션 (숨김 처리) -->
					<div class="edit-group-section" id="editGroupSection" style="display: none;">
						<h2>그룹 수정하기</h2>
						<!-- 그룹 생성 폼과 동일한 양식 -->
						<form id="edit-group-form" method="post" th:action="@{/edit-group/{id}(id=${group.id})}">
							<input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}"
								th:value="${_csrf.token}">
							<div class="form-group">
								<label for="group-name">그룹 이름</label>
								<input type="text" id="group-name" name="groupName" placeholder="소모임 이름을 입력하세요"
									required>
								<div class="help-text">그룹 이름은 간결하고 명확하게 작성하세요.</div>
							</div>

							<div class="form-group">
								<label for="group-category">그룹 카테고리</label>
								<div id="category-buttons" class="category-buttons">
									<button type="button" class="category-button" th:each="category : ${categories}"
										th:text="${category.koName}" th:data-value="${category.name()}"
										onclick="selectCategory(this)"></button>
								</div>
								<div class="help-text">그룹의 카테고리를 선택하세요.</div>
								<input type="hidden" name="category" id="selected-category">
							</div>

							<div class="form-group">
								<label for="group-greeting">그룹 인삿말</label>
								<div id="group-greeting-editor" style="height: 150px;"></div>
								<div class="help-text">인삿말을 간단하게 작성하세요.</div>
							</div>

							<div class="form-group">
								<label for="group-description">그룹 설명</label>
								<div id="group-description-editor" style="height: 150px;"></div>
								<div class="help-text">그룹 활동과 목적을 간단하게 설명하세요.</div>
							</div>

							<div class="form-group">
								<label for="group-image">그룹 대표 이미지</label>
								<input type="file" id="group-image" name="groupImage" accept="image/*">
								<div id="group-image-preview" class="image-preview-container"></div>
								<div class="help-text">이미지를 업로드하여 그룹을 대표할 수 있습니다.</div>
							</div>

							<!-- 숨겨진 input 필드를 추가하여 Quill 내용을 저장 -->
							<input type="hidden" name="greeting" id="group-greeting-input" value="">
							<input type="hidden" name="description" id="group-description-input" value="">
							<input type="hidden" name="mainImageBucketKey" id="mainImageBucketKey">
							<input type="hidden" name="mainImageOrgName" id="mainImageOrgName">

							<button type="submit" class="submit-button">저장하기</button>
							<button type="button" class="cancel-button" onclick="cancelEditGroup()">취소</button>
						</form>
					</div>
				</div>
			</div>
		</div>
		</div>
	</main>
</body>

</html>